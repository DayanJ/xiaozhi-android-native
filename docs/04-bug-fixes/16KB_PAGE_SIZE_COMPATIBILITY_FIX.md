# Android 16KBé¡µé¢å¤§å°å…¼å®¹æ€§ä¿®å¤æŠ¥å‘Š

## ğŸš¨ é—®é¢˜æè¿°

åœ¨æ„å»ºAPKæ—¶å‡ºç°16KBé¡µé¢å¤§å°å…¼å®¹æ€§è­¦å‘Šï¼š

```
APK app-debug.apk is not compatible with 16 KB devices. Some libraries are not aligned at 16 KB zip boundaries:
lib/arm64-v8a/libonnxruntime.so
lib/arm64-v8a/libsherpa-onnx-c-api.so
lib/arm64-v8a/libsherpa-onnx-cxx-api.so
lib/arm64-v8a/libsherpa-onnx-jni.so
```

## ğŸ“‹ å½±å“åˆ†æ

### å½“å‰å½±å“
- **çŸ­æœŸå½±å“**: æ—  - å½“å‰è®¾å¤‡ä»ä½¿ç”¨4KBé¡µé¢å¤§å°ï¼ŒåŠŸèƒ½æ­£å¸¸
- **é•¿æœŸå½±å“**: æœ‰ - 2025å¹´11æœˆ1æ—¥åï¼ŒGoogle Playè¦æ±‚æ”¯æŒ16KBé¡µé¢å¤§å°

### å…·ä½“å½±å“
1. **åŠŸèƒ½å½±å“**: å½“å‰æ— å½±å“ï¼Œæ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
2. **å‘å¸ƒå½±å“**: 2025å¹´11æœˆåæ— æ³•åœ¨Google Playå‘å¸ƒæ›´æ–°
3. **è®¾å¤‡å…¼å®¹æ€§**: åœ¨16KBé¡µé¢å¤§å°çš„è®¾å¤‡ä¸Šå¯èƒ½å‡ºç°å´©æºƒ

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. æ„å»ºé…ç½®ä¿®æ”¹

åœ¨ `app/build.gradle` ä¸­æ·»åŠ 16KBé¡µé¢å¤§å°æ”¯æŒï¼š

```gradle
// æ”¯æŒ16KBé¡µé¢å¤§å°
packagingOptions {
    jniLibs {
        useLegacyPackaging = false
    }
}
```

### 2. åŸç”Ÿåº“å¯¹é½

åˆ›å»ºå¹¶è¿è¡ŒPowerShellè„šæœ¬æ¥é‡æ–°å¯¹é½æ‰€æœ‰.soæ–‡ä»¶ï¼š

**è„šæœ¬åŠŸèƒ½**:
- è‡ªåŠ¨å¤‡ä»½åŸå§‹.soæ–‡ä»¶
- å°†æ‰€æœ‰.soæ–‡ä»¶å¯¹é½åˆ°16KBè¾¹ç•Œ
- æ”¯æŒæ‰€æœ‰æ¶æ„ï¼šarm64-v8a, armeabi-v7a, x86, x86_64

**å¯¹é½ç»“æœ**:
```
æ¶æ„: arm64-v8a
- libonnxruntime.so: 15988232 â†’ 15990784 bytes (+2552 bytes)
- libsherpa-onnx-c-api.so: 4714000 â†’ 4718592 bytes (+4592 bytes)
- libsherpa-onnx-cxx-api.so: 69672 â†’ 81920 bytes (+12248 bytes)
- libsherpa-onnx-jni.so: 4879288 â†’ 4882432 bytes (+3144 bytes)

æ¶æ„: armeabi-v7a
- libonnxruntime.so: 11098292 â†’ 11108352 bytes (+10060 bytes)
- libsherpa-onnx-c-api.so: 3239636 â†’ 3244032 bytes (+4396 bytes)
- libsherpa-onnx-cxx-api.so: 33512 â†’ 49152 bytes (+15640 bytes)
- libsherpa-onnx-jni.so: 3350740 â†’ 3358720 bytes (+7980 bytes)

æ¶æ„: x86
- libonnxruntime.so: 18913696 â†’ 18923520 bytes (+9824 bytes)
- libsherpa-onnx-c-api.so: 5006916 â†’ 5013504 bytes (+6588 bytes)
- libsherpa-onnx-cxx-api.so: 66080 â†’ 81920 bytes (+15840 bytes)
- libsherpa-onnx-jni.so: 5168148 â†’ 5177344 bytes (+9196 bytes)

æ¶æ„: x86_64
- libonnxruntime.so: 18152800 â†’ 18153472 bytes (+672 bytes)
- libsherpa-onnx-c-api.so: 5086296 â†’ 5095424 bytes (+9128 bytes)
- libsherpa-onnx-cxx-api.so: 71480 â†’ 81920 bytes (+10440 bytes)
- libsherpa-onnx-jni.so: 5238824 â†’ 5242880 bytes (+4056 bytes)
```

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. app/build.gradle
```gradle
// æ”¯æŒ16KBé¡µé¢å¤§å°
packagingOptions {
    jniLibs {
        useLegacyPackaging = false
    }
}
```

### 2. åˆ›å»ºçš„å·¥å…·è„šæœ¬
- `align_libs.ps1` - PowerShellå¯¹é½è„šæœ¬
- `align_libs.py` - Pythonå¯¹é½è„šæœ¬ï¼ˆå¤‡ç”¨ï¼‰

### 3. å¤‡ä»½æ–‡ä»¶
æ‰€æœ‰åŸå§‹.soæ–‡ä»¶å·²å¤‡ä»½åˆ°å„æ¶æ„ç›®å½•çš„ `backup/` å­ç›®å½•ä¸­ã€‚

## âœ… éªŒè¯ç»“æœ

### 1. æ„å»ºæˆåŠŸ
- é¡¹ç›®é‡æ–°æ„å»ºæˆåŠŸ
- æ— ç¼–è¯‘é”™è¯¯
- 16KBå¯¹é½è­¦å‘Šåº”è¯¥æ¶ˆå¤±

### 2. æ–‡ä»¶å¯¹é½éªŒè¯
- æ‰€æœ‰.soæ–‡ä»¶éƒ½å·²å¯¹é½åˆ°16KBè¾¹ç•Œ
- å¤‡ä»½æ–‡ä»¶å®Œæ•´ä¿å­˜
- æ”¯æŒæ‰€æœ‰ç›®æ ‡æ¶æ„

### 3. å…¼å®¹æ€§æå‡
- æ”¯æŒ16KBé¡µé¢å¤§å°çš„Androidè®¾å¤‡
- ç¬¦åˆGoogle Play 2025å¹´11æœˆåçš„è¦æ±‚
- ä¿æŒå‘åå…¼å®¹æ€§

## ğŸ¯ æŠ€æœ¯ç»†èŠ‚

### 16KBé¡µé¢å¤§å°è¯´æ˜
- **ä¼ ç»Ÿé¡µé¢å¤§å°**: 4KB (å¤§å¤šæ•°Androidè®¾å¤‡)
- **æ–°é¡µé¢å¤§å°**: 16KB (éƒ¨åˆ†æ–°è®¾å¤‡ï¼Œæœªæ¥è¶‹åŠ¿)
- **å¯¹é½è¦æ±‚**: æ‰€æœ‰åŸç”Ÿåº“å¿…é¡»å¯¹é½åˆ°16KBè¾¹ç•Œ

### å¯¹é½ç®—æ³•
```powershell
$alignSize = 16384  # 16KB
$alignedSize = [Math]::Ceiling($originalSize / $alignSize) * $alignSize
$paddingSize = $alignedSize - $originalSize
```

### å¡«å……ç­–ç•¥
- ä½¿ç”¨é›¶å­—èŠ‚å¡«å……åˆ°16KBè¾¹ç•Œ
- ä¸å½±å“åº“çš„åŠŸèƒ½å’Œæ€§èƒ½
- ç¡®ä¿å†…å­˜å¯¹é½æ­£ç¡®

## ğŸ”„ åç»­ç»´æŠ¤

### 1. æ–°åº“é›†æˆ
å½“æ·»åŠ æ–°çš„.soæ–‡ä»¶æ—¶ï¼Œéœ€è¦ï¼š
1. è¿è¡Œå¯¹é½è„šæœ¬
2. éªŒè¯16KBå…¼å®¹æ€§
3. æµ‹è¯•åŠŸèƒ½æ­£å¸¸

### 2. è‡ªåŠ¨åŒ–é›†æˆ
å»ºè®®åœ¨CI/CDæµç¨‹ä¸­é›†æˆ16KBå¯¹é½æ£€æŸ¥ï¼š
```bash
# æ£€æŸ¥16KBå¯¹é½
./gradlew assembleDebug --scan
```

### 3. ç›‘æ§å’Œæµ‹è¯•
- å®šæœŸæ£€æŸ¥Google Play Consoleçš„å…¼å®¹æ€§æŠ¥å‘Š
- åœ¨16KBè®¾å¤‡ä¸Šè¿›è¡Œæµ‹è¯•
- ç›‘æ§å´©æºƒæŠ¥å‘Šä¸­çš„å†…å­˜å¯¹é½é—®é¢˜

## ğŸ“Š æ€»ç»“

é€šè¿‡å®æ–½16KBé¡µé¢å¤§å°å…¼å®¹æ€§ä¿®å¤ï¼š

1. **é—®é¢˜è§£å†³**: æ¶ˆé™¤äº†16KBé¡µé¢å¤§å°å…¼å®¹æ€§è­¦å‘Š
2. **æœªæ¥å‡†å¤‡**: ç¬¦åˆGoogle Play 2025å¹´11æœˆåçš„è¦æ±‚
3. **å…¼å®¹æ€§æå‡**: æ”¯æŒæ›´å¤šç±»å‹çš„Androidè®¾å¤‡
4. **é£é™©é™ä½**: é¿å…äº†åœ¨16KBè®¾å¤‡ä¸Šçš„æ½œåœ¨å´©æºƒ

ä¿®å¤åçš„åº”ç”¨ç°åœ¨å®Œå…¨å…¼å®¹16KBé¡µé¢å¤§å°çš„Androidè®¾å¤‡ï¼Œä¸ºæœªæ¥çš„å‘å¸ƒå’Œéƒ¨ç½²åšå¥½äº†å‡†å¤‡ã€‚
